{"version":3,"file":"block-form/view.js","mappings":"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","sources":["webpack://vsau-blocks/./src/block-form/view.js"],"sourcesContent":["let isHandlerAdded = false; // Флаг для отслеживания добавления обработчика\n\nconst init = () => {\n\tconst form = document.getElementById(\"send_email\");\n\tif (form && !isHandlerAdded) {\n\t\t// Убираем стандартное поведение формы\n\t\tform.addEventListener(\"submit\", (event) => {\n\t\t\tevent.preventDefault(); // Отменяем стандартную отправку формы\n\n\t\t\t// Собираем данные из формы\n\t\t\tconst formData = new FormData(form);\n\n\t\t\t// Преобразуем FormData в объект\n\t\t\tconst data = {};\n\t\t\tformData.forEach((value, key) => {\n\t\t\t\tdata[key] = value;\n\t\t\t});\n\n\t\t\t// Добавляем email из disabled поля\n\t\t\tconst disabledEmail = form.querySelector('input[name=\"email\"]').value;\n\t\t\tdata.email = disabledEmail;\n\n\t\t\tconsole.log(\"Form data:\", data);\n\n\t\t\t// Валидация полей\n\t\t\tif (!data.abit_fio || !data.abit_email || !data.abit_text) {\n\t\t\t\talert(\"Пожалуйста, заполните все поля.\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Отправляем данные на сервер\n\t\t\tsendHandler(data);\n\t\t});\n\n\t\tisHandlerAdded = true; // Устанавливаем флаг, чтобы обработчик не добавлялся снова\n\t\tconsole.log(\"Form handler added.\");\n\t}\n};\n\nconst observeDOM = () => {\n\tconst observer = new MutationObserver((mutationsList) => {\n\t\tfor (const mutation of mutationsList) {\n\t\t\tif (mutation.type === \"childList\") {\n\t\t\t\tinit();\n\t\t\t}\n\t\t}\n\t});\n\n\tobserver.observe(document.body, {\n\t\tchildList: true, // Наблюдаем за добавлением/удалением дочерних элементов\n\t\tsubtree: true, // Наблюдаем за изменениями во всех поддеревьях\n\t});\n};\n\nif (document.readyState === \"loading\") {\n\tdocument.addEventListener(\"DOMContentLoaded\", observeDOM);\n} else {\n\tobserveDOM();\n}\n\n// Определение URL для отправки\nconst sendHandler = (data) => {\n\tconst host = window.location.hostname;\n\tlet url;\n\n\tif (host === \"localhost\") {\n\t\turl = \"http://verba.gurgurich.ru/wp-json/abit/v1/email\";\n\t} else {\n\t\turl = window.location.href + \"/wp-json/abit/v1/email\";\n\t}\n\n\tsendRequest(url, data);\n};\n\n// Функция для отправки запроса\nconst sendRequest = (url, data) => {\n\tconst submitButton = document.querySelector(\n\t\t'#send_email button[type=\"submit\"]',\n\t);\n\tif (submitButton) {\n\t\tsubmitButton.disabled = true; // Отключаем кнопку отправки\n\t}\n\n\tfetch(url, {\n\t\tmethod: \"POST\",\n\t\theaders: {\n\t\t\t\"Content-Type\": \"application/json\",\n\t\t},\n\t\tbody: JSON.stringify(data),\n\t})\n\t\t.then((response) => response.json())\n\t\t.then((data) => {\n\t\t\tconsole.log(\"Response:\", data.message);\n\t\t\talert(data.message); // Показываем сообщение от сервера\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error(\"Error:\", error);\n\t\t\talert(\"Произошла ошибка при отправке формы.\");\n\t\t})\n\t\t.finally(() => {\n\t\t\tif (submitButton) {\n\t\t\t\tsubmitButton.disabled = false; // Включаем кнопку отправки\n\t\t\t}\n\t\t});\n};\n"],"names":["isHandlerAdded","init","form","document","getElementById","addEventListener","event","preventDefault","formData","FormData","data","forEach","value","key","disabledEmail","querySelector","email","console","log","abit_fio","abit_email","abit_text","alert","sendHandler","observeDOM","observer","MutationObserver","mutationsList","mutation","type","observe","body","childList","subtree","readyState","host","window","location","hostname","url","href","sendRequest","submitButton","disabled","fetch","method","headers","JSON","stringify","then","response","json","message","catch","error","finally"],"sourceRoot":""}